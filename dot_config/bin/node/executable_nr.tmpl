#!/bin/bash

{{ template "shared_bin_utils.sh.tmpl" . }}

{{ template "shared_pick_node_package_manager.tmpl" . -}}

if [ ! -f "package.json" ]; then
  exit 0
fi

if [ "$#" -gt 0 ]; then
  case "$(_pick_node_package_manager)" in
    yarn) yarn "$@" ;;
    pnpm) pnpm run "$@" ;;
    npm) npm run "$@" ;;
  esac
  exit 0
fi

COMMAND="$(jq -r '.scripts | keys[]' package.json | gum filter)"

if [ ! -n "$COMMAND" ]; then
  exit 0
fi

info "Running [$COMMAND]"

case "$(_pick_node_package_manager)" in
  yarn) yarn "$COMMAND" ;;
  pnpm) pnpm run "$COMMAND" ;;
  npm) npm run "$COMMAND" ;;
esac
